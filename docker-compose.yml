version: "3.9"

services:
  nginx:
    image: nginx:alpine
    container_name: distri-place-nginx
    ports:
      - "8080:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./client:/usr/share/nginx/html:ro
    environment:
      - DEPLOYMENT_MODE=${DEPLOYMENT_MODE:-dev}
    depends_on:
      - node-1
      - node-2
      - node-3
    networks:
      - distri-place-network
  node-1:
    build: ./server
    container_name: distri-place-node-1
    environment:
      - NODE_ID=node-1
      - PORT=8000
      - PEERS=node-2,node-3
    networks:
      - distri-place-network

  node-2:
    build: ./server
    container_name: distri-place-node-2
    environment:
      - NODE_ID=node-2
      - PORT=8000
      - PEERS=node-1,node-3
    networks:
      - distri-place-network

  node-3:
    build: ./server
    container_name: distri-place-node-3
    environment:
      - NODE_ID=node-3
      - PORT=8000
      - PEERS=node-1,node-2
    networks:
      - distri-place-network

  client:
    image: nginx:alpine
    container_name: distri-place-client
    ports:
      - "3000:80"
    volumes:
      - ./client:/usr/share/nginx/html:ro

networks:
  distri-place-network:
    driver: bridge
